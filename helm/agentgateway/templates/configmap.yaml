apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-config
  namespace: {{ .Release.Namespace }}
data:
  config.yaml: |
    binds:
      - port: 3000
        listeners:
          - routes:
              - policies:
                  cors:
                    allowOrigins:
                      - "*"
                    allowHeaders:
                      - mcp-protocol-version
                      - content-type
                      - cache-control
                      - authorization
                    exposeHeaders:
                      - "Mcp-Session-Id"
                  rateLimit:
                    requestsPerMinute: {{ .Values.rateLimit.requestsPerMinute }}
                    burstSize: {{ .Values.rateLimit.burstSize }}
                backends:
                  - mcp:
                      targets:
                        - name: policyguard
                          http:
                            url: {{ .Values.policyguardUrl }}
                            timeout: 30s
